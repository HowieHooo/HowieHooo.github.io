<!DOCTYPE html>
<meta charset="utf-8">
<script src="d3/d3.js"></script>
<script scr="d3/d3.min.js"></script>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<style>

.node {
  stroke: #000;
  stroke-width: 1.5px;
}

.link {
  stroke: #999;
  stroke-width: 1.5px;
}
    
div.tooltip {
  position: absolute;
  text-align: center;
  width: 100px;
  height: 120px;
  padding: 2px;
  font: 15px sans-serif;
  background: lightblue;
  border: 2px;
  border-radius: 15px;
  pointer-events: none;
}
h1{
    text-align: center;
    margin-top: -20px;
}
h3{
    margin-bottom: 10px;
}
button{
    margin-left: 5px;
    margin-bottom: 8px;
}

svg{
    border-style: inset;
    margin-bottom: 15px;
    margin-top: 15px;
}
.footer{
    margin-bottom: 100px;
}
p{
    text-align: center;
    margin-bottom: -10px;
}

</style>



<body>
    <div class="jumbotron">
        <h1 class="display-5">LinkedIn connections visualization</h1>
        <p clas="lead">Finding the right connections in a company would be hard on LinkedIn. Each connections has several relationships to a target
        company. Which connection should we connect? How many connections do I have in a target company? This visualization will give you a whole view of the connections in a target company. Then user then could easily find the most related connection to contact. Each data is linked by degree.</p>
    </div>
    
    <div class="container">
        <div class="row">
            <h3>Search by target company: </h3>
        </div>
        <div class="input-group mb-3">
          <input type="text" class="form-control" placeholder="Please type in the company name." aria-label="Please type in the company name." aria-describedby="basic-addon2">
          <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="button">Search</button>
          </div>
        </div>
        </div>
    <div class="container">
        <div class="row">
            <h3>Search by famous company tags: </h3>
        </div>
        <div id="buttonrow" class="row">
            <div class="col">
            <button type="button" class="btn btn-outline-secondary">
                <img src="Images/linkedin-256.png" width="120" height="80"/>
            </button>
            <button type="button" class="btn btn-outline-secondary">
                <img src="Images/ebay-256.png" width="120" height="80"/>
            </button>
            <button type="button" class="btn btn-outline-secondary">
                <img src="Images/social-apple-outline.png" width="120" height="80"/>
            </button>
            <button type="button" class="btn btn-outline-secondary">
                <img src="Images/uber-icon.png" width="120" height="80"/>
            </button>
            <button type="button" class="btn btn-outline-secondary">
                <img src="Images/microsoft-256.png" width="120" height="80"/>
            <button type="button" class="btn btn-outline-secondary">
                <img src="Images/amazon-256.png" width="120" height="80"/>
            </button>
            <button type="button" class="btn btn-outline-secondary">
                <img src="Images/netflix-icon.png" width="120" height="80"/>
            </button>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <button type="button" class="btn btn-outline-secondary">
                    <img src="Images/facebook-icon.png" width="120" height="80"/>
                </button>
                <button type="button" class="btn btn-outline-secondary">
                    <img src="Images/walmart-icon.jpeg"  width="120" height="80"/>
                </button>
                <button type="button" class="btn btn-outline-secondary">
                    <img src="Images/airbnb-icon.png" width="120" height="80"/>
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <svg class= "graph" width="1100" height="550"></svg>
    </div>
    

    
<script>
    var zoom = d3.zoom()
    .scaleExtent([1, 8])
    .on("zoom", zoomed);
    
    var svg = d3.select("svg"),
        width = +svg.attr("width"),
        height = +svg.attr("height"),
//        width = window.innerHeight,
//        height = window.innerWidth,
        r = 15;
    
    var g = svg.append("g");
    svg.call(zoom);

    
    var div = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);
    
    var simulation = d3.forceSimulation()
        .force("charge", d3.forceManyBody().strength(-300))
        .force("link", d3.forceLink().id(function(d) { return d.name; }).distance(100))
        .force("x", d3.forceX(width / 2))
        .force("y", d3.forceY(height / 2))
        .force("collide", d3.forceCollide(r + 5))
    
    function zoomed() {
      g.style("stroke-width", 1.5 / d3.event.transform.k + "px");
      g.attr("transform", d3.event.transform); // updated for d3 v4
    }
	
	
	d3.csv("Netflix.csv", function(error, csvdata){
        var nodesNetflix = [];
        var linksNextflix = [];
        var linkedByName = {};
        if(error){
            console.log(error)
        }
        

        for(var i = 0; i<csvdata.length; i++){
            var littleNode = new Object();
            littleNode.name = csvdata[i].Name;
            littleNode.url = csvdata[i].ImageURL;
            littleNode.company = csvdata[i].Company;
            nodesNetflix[i] = littleNode;
            var littleLink = new Object();
            littleLink.source = csvdata[i].RelatedConnectionName;
            littleLink.target = csvdata[i].Name;
            linksNextflix[i] = littleLink;
            linkedByName[littleLink.source + "," + littleLink.target] = true;
        }
        
        var centerNode = new Object();
        centerNode.name = "Hongyu Hua";
        centerNode.url = "https://media.licdn.com/mpr/mpr/shrinknp_400_400/AAEAAQAAAAAAAAoYAAAAJDA3YjJlZjE2LTQ2ODAtNDRjZi1hMzhiLTUwZGE0YmUyNDMyYg.jpg";
        centerNode.company = "eBay";
        nodesNetflix.push(centerNode);
        
//        console.log(nodesNetflix);
        
        simulation.nodes(nodesNetflix);
        simulation.force("link").links(linksNextflix);
        
        var link = g.selectAll(".link")
            .data(linksNextflix)
            .enter().append("line")
            .attr("class", "link")
            .style("stroke-width",nominal_stroke)
	        .style("stroke", default_link_color);
        
        var node = g.selectAll(".node")
            .data(nodesNetflix)
            .enter().append("g")
            .attr("class", "node")
        
        var circle = node.append("circle")
            .attr("r", function(d) { return Math.sqrt(d.size) / 10 || 4.5; })
            .style("fill", "#eee")
            .call(d3.drag()
                 .on("start",dragstarted)
                 .on("drag",dragged)
                 .on("end",dragended));
        
        
        var images = node.append("svg:image")
              .attr("xlink:href", function(d){return d.url})
              .attr("x", -10)
              .attr("y", -10)
              .attr("width", 30)
              .attr("height", 30)
              .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

    
    
        function dragstarted() {
          if (!d3.event.active) simulation.alphaTarget(0.3).restart();
          d3.event.subject.fx = d3.event.subject.x;
          d3.event.subject.fy = d3.event.subject.y;
        }

        function dragged() {
          d3.event.subject.fx = d3.event.x;
          d3.event.subject.fy = d3.event.y;
        }

        function dragended() {
          if (!d3.event.active) simulation.alphaTarget(0);
          d3.event.subject.fx = null;
          d3.event.subject.fy = null;
        }
        

      node.append("text")
      .attr("dx", 21)
      .attr("dy", "0.5em")
      .attr("font-size", 12)
      .text(function(d){
          if(d.company == "LinkedIn"){
              return d.company;
          }
      });
        
        function isConnected(a, b) {
            return linkedByName[a.name + "," + b.name] || linkedByName[b.name + "," + a.name] || a.name == b.name;
        }
        
        var highlight_color = "red";
        var default_link_color = "#888";
        var focus_node = null;
        var highlight_node = null;
        var towhite = "stroke";
        var nominal_stroke = 1.5;
        
        function set_highlight(d){
            svg.style("cursor","pointer");
            if (focus_node!==null) d = focus_node;
            highlight_node = d;

            if (highlight_color!="white")
            {
//                circle.style(towhite, function(o) {
//                return isConnected(d, o) ? highlight_color : "white";});
                    link.style("stroke", function(o) {
                        //why this would happen?
                      return o.source.index == d.index || o.target.index == d.index ? highlight_color : default_link_color;
                    });
            }
        }
        
        var mouseEvent = node.on('mouseover', function(d){
            set_highlight(d);
        });
        
        
    
      var mouseEvent = images.on('mouseover', function(d) {
            // select element in current context
            d3.select( this )
              .transition()
              .attr("x", function(d) { return -60;})
              .attr("y", function(d) { return -60;})
              .attr("height", 100)
              .attr("width", 100);
          
            div.transition()
                .duration(200)
                .style("opacity", .9)
            div.html("Name: " + d.name + "<br/>" + "<br/>" + "Company: " + d.company)
                .style("left", (d3.event.pageX + 50) + "px")
                .style("top", (d3.event.pageY - 50) + "px");
          })
          // set back
          .on( 'mouseout', function() {
            d3.select( this )
              .transition()
              .attr("x", function(d) { return -10;})
              .attr("y", function(d) { return -10;})
              .attr("height", 30)
              .attr("width", 30);
              
            div.transition()
               .duration(500)
               .style("opacity", 0);
          });

        
        simulation.on("tick", function() {
    link.attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

    node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });

	});
});
    
   
</script>

<div class="jumbotron" style="margin-bottom: 0px">
    <div class="row">
      <div class="col-sm-4">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Special title treatment</h4>
            <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
          </div>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Special title treatment</h4>
            <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
          </div>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Special title treatment</h4>
            <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
          </div>
        </div>
      </div>
    </div>
</div>
</body>

